sequenceDiagram
    actor Sales
    participant OrdersPage as OrdersPage (app/(dashboard)/orders/page.tsx)
    participant ReadyHook as useAuthedSWR('/orders/ready-to-close')
    participant ItemsHook as useAuthedSWR(`/orders/${id}/items`)
    participant ApiFetch as apiFetch(...)
    participant Backend as Inventory API

    Sales->>OrdersPage: เปิดแท็บ "พร้อมปิด Order"
    OrdersPage->>ReadyHook: useAuthedSWR('/orders/ready-to-close', token)
    ReadyHook->>ApiFetch: apiFetch('/orders/ready-to-close', { token })
    ApiFetch->>Backend: GET /orders/ready-to-close
    Backend-->>OrdersPage: Order ที่พร้อมปิด

    Sales->>OrdersPage: เลือก Order เพื่อตรวจสอบ
    OrdersPage->>ItemsHook: useAuthedSWR(`/orders/${orderId}/items`, token)
    ItemsHook->>ApiFetch: apiFetch(`/orders/${orderId}/items`, { token })
    ApiFetch->>Backend: GET /orders/{orderId}/items
    Backend-->>OrdersPage: รายการสินค้าใน Order

    Sales->>OrdersPage: กด "ปิด Order"
    OrdersPage->>OrdersPage: handleCloseOrder(orderId)
    OrdersPage->>ApiFetch: apiFetch(`/orders/${orderId}/close`, { method: 'PUT', token })
    ApiFetch->>Backend: PUT /orders/{id}/close
    Backend-->>ApiFetch: ปิด Order สำเร็จ
    ApiFetch-->>OrdersPage: ผลลัพธ์สำเร็จ
    OrdersPage->>OrdersPage: setSuccessMessage() + ปิด modal
    OrdersPage->>ReadyHook: mutate()
    ReadyHook->>ApiFetch: apiFetch('/orders/ready-to-close', { token })
    ApiFetch->>Backend: GET /orders/ready-to-close (refresh)
    Backend-->>OrdersPage: รายการล่าสุด
    OrdersPage->>OrdersPage: mutateAll()
    OrdersPage-->>Sales: แสดงว่า Order ถูกปิดแล้ว
