
sequenceDiagram
    actor Foreman
    participant UI as ApproveRequestPage (View)
    participant C as RequestController
    participant DB as Database

    Foreman ->> UI: กด "Approve Request"
    UI ->> C: validateRole(staff_id from token)
    C ->> DB: SELECT staff_id, role FROM Staff WHERE staff_id=? AND active=true
    DB -->> C: role=Foreman
    C -->> UI: allow ApproveRequestPage

    Foreman ->> UI: ดูรายการ Request
    UI ->> C: getPendingRequests()
    C ->> DB: SELECT request_id, request_date, staff_id, order_id, status FROM Request WHERE status='Pending'
    DB -->> C: list<Request>
    C -->> UI: display pending requests

    Foreman ->> UI: เลือก Request
    UI ->> C: getRequestItems(requestId)
    C ->> DB: SELECT product_id, quantity, fulfilled_qty, remaining_qty FROM RequestItem WHERE request_id=?
    DB -->> C: list<RequestItem>
    C -->> UI: display Request + items

    Foreman ->> UI: กด Approve / Reject
    UI ->> C: POST /requests/:id/approve (decision)
    alt Approve
        C ->> DB: UPDATE Request SET status='Approved', approved_by=?, approved_date=NOW() WHERE request_id=?
    else Reject
        C ->> DB: UPDATE Request SET status='Rejected', approved_by=?, approved_date=NOW() WHERE request_id=?
    end
    DB -->> C: success
    C -->> UI: display confirmation (Approved/Rejected)
    UI -->> Foreman: show result
    