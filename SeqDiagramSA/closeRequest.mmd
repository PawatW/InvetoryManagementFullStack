sequenceDiagram
    actor Technician as Technician/Warehouse
    participant RequestsPage as RequestsPage (app/(dashboard)/requests/page.tsx)
    participant ReadyHook as useAuthedSWR('/requests/ready-to-close')
    participant ItemsHook as useAuthedSWR(`/requests/${id}/items`)
    participant ApiFetch as apiFetch(...)
    participant Backend as Inventory API

    Technician->>RequestsPage: เปิดแท็บ "พร้อมปิดคำขอ"
    RequestsPage->>ReadyHook: useAuthedSWR('/requests/ready-to-close', token)
    ReadyHook->>ApiFetch: apiFetch('/requests/ready-to-close', { token })
    ApiFetch->>Backend: GET /requests/ready-to-close
    Backend-->>RequestsPage: รายการคำขอที่เบิกครบ

    Technician->>RequestsPage: เลือกคำขอเพื่อดูรายละเอียด
    RequestsPage->>ItemsHook: useAuthedSWR(`/requests/${requestId}/items`, token)
    ItemsHook->>ApiFetch: apiFetch(`/requests/${requestId}/items`, { token })
    ApiFetch->>Backend: GET /requests/{requestId}/items
    Backend-->>RequestsPage: รายการสินค้า

    Technician->>RequestsPage: กดปุ่ม "ปิดคำขอ"
    RequestsPage->>RequestsPage: handleCloseRequest(requestId)
    RequestsPage->>ApiFetch: apiFetch(`/requests/${requestId}/close`, { method: 'PUT', token })
    ApiFetch->>Backend: PUT /requests/{id}/close
    Backend-->>ApiFetch: ปิดคำขอสำเร็จ
    ApiFetch-->>RequestsPage: ผลลัพธ์สำเร็จ
    RequestsPage->>RequestsPage: setSuccessMessage() + ปิด modal
    RequestsPage->>ReadyHook: mutate()
    ReadyHook->>ApiFetch: apiFetch('/requests/ready-to-close', { token })
    ApiFetch->>Backend: GET /requests/ready-to-close (refresh)
    Backend-->>RequestsPage: อัปเดตสถานะ
    RequestsPage-->>Technician: แสดงผลว่าปิดคำขอเรียบร้อย
